# Company Management Service

## Description

This project is a Company Management Service built with Go. It provides a RESTful API for managing company information, user authentication, and includes features such as event sourcing using an outbox pattern with Kafka integration.

Key features:
- CRUD operations for company management
- User registration and authentication with JWT
- Event sourcing using outbox pattern
- Kafka integration for event publishing
- PostgreSQL database for data persistence
- Docker support for easy deployment and development

## Table of Contents

1. [Setup](#setup)
2. [Running the Application](#running-the-application)
3. [API Endpoints](#api-endpoints)
4. [Testing](#testing)
5. [Project Structure](#project-structure)

## Setup

1. Clone the repository:
   ```
   git clone https://github.com/Assylzhan-a/company-task.git
   cd company-task
   ```

2. Configuration:
   To change the configuration, edit the `app.env` file in the root directory. Default env is already configured mirroring local docker setup confs.

3. Run database migrations:
   ```
   make migrate-up
   ```

## Running the Application

To start the application and its dependencies (PostgreSQL, Kafka, etc.), run:

```
make run
```

This command uses Docker Compose to set up and run all necessary services.

## API Endpoints

Here are the main API endpoints with curl examples:

### User Registration

```bash
curl -X POST http://localhost:8080/v1/users/register \
  -H "Content-Type: application/json" \
  -d '{"username": "newuser", "password": "password123"}'
```

### User Login

```bash
curl -X POST http://localhost:8080/v1/users/login \
  -H "Content-Type: application/json" \
  -d '{"username": "newuser", "password": "password123"}'
```

This will return a JWT token to use for authenticated requests.

### Create Company

```bash
curl -X POST http://localhost:8080/v1/companies \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{
    "id": "123e4567-e89b-12d3-a456-426614174000",
    "name": "Tech Corp",
    "description": "Innovative technology solutions",
    "amount_of_employees": 100,
    "registered": true,
    "type": "Corporations"
  }'
```

Note: The `id` field should be a valid UUID generated by the client.

### Get Company

```bash
curl -X GET http://localhost:8080/v1/companies/123e4567-e89b-12d3-a456-426614174000 \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

### Update Company

```bash
curl -X PATCH http://localhost:8080/v1/companies/123e4567-e89b-12d3-a456-426614174000 \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{
    "name": "Updated Tech Corp",
    "amount_of_employees": 150
  }'
```

### Delete Company

```bash
curl -X DELETE http://localhost:8080/v1/companies/123e4567-e89b-12d3-a456-426614174000 \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

## Testing

To run the test suite:

```
make test
```

This command uses a separate Docker Compose file for testing, ensuring a clean and isolated test environment.

## Linting

To run the linter:

```
make lint
```

## Project Structure

```
.
├── cmd
│   └── api
│       └── main.go
├── config
│   └── config.go
├── internal
│   ├── auth
│   ├── db
│   ├── delivery
│   ├── domain
│   ├── kafka
│   ├── ports
│   └── worker
├── migrations
├── pkg
│   ├── errors
│   └── logger
├── tests
├── Dockerfile
├── docker-compose.yml
├── app.env
├── go.mod
├── go.sum
└── Makefile
```

This structure follows clean architecture principles, separating concerns into different layers (delivery, domain, infrastructure) for improved maintainability and testability.

## Contributing

Please read CONTRIBUTING.md for details on our code of conduct, and the process for submitting pull requests.

## License

This project is licensed under the MIT License - see the LICENSE file for details.